metadata:
  created_at: "2026-01-14T12:00:00Z"
  created_by: Discovery-Agent
  version: "1.0"
  source_idea: Simplify the project by removing intake/plan/security/review skills, making Discovery the sole planning entry point
  outcomes:
    - All planning work enters through /discovery - one skill for idea to plan
    - /simulate remains available to explore plans before execution
    - Worker agents use execute/verify/report when dispatched by orchestrator
    - Removed skills (intake, plan, security, review) no longer exist
    - Documentation reflects the simplified workflow consistently
  source_branch: main
  work_branch: plan/simplify-workflow-to-discovery
  completed_at: "2026-01-15T02:46:02.110Z"
  outcome: success
steps:
  - id: "1.1"
    description: Delete the intake skill directory
    status: complete
    deps: []
    parallel: true
    context: |
      The intake skill is being removed because Discovery now handles all planning
      work, including smaller feature requests. The intake skill was previously
      used for single, scoped features but this is now handled by Discovery's
      full decomposition ladder.
    requirements:
      - Delete the entire agent/skills/intake/ directory
      - Verify no orphaned references remain in the skills folder
    criteria:
      - Directory agent/skills/intake/ no longer exists
      - No build or runtime errors from missing skill
    files:
      - agent/skills/intake/SKILL.md
    context_files: []
    agent: codex
  - id: "1.2"
    description: Delete the plan skill directory
    status: complete
    deps: []
    parallel: true
    context: |
      The plan skill is being removed because Discovery produces orchestrator-ready
      plans directly. The separate Plan phase was redundant when Discovery already
      outputs complete implementation steps.
    requirements:
      - Delete the entire agent/skills/plan/ directory
    criteria:
      - Directory agent/skills/plan/ no longer exists
    files:
      - agent/skills/plan/SKILL.md
    context_files: []
    agent: codex
  - id: "1.3"
    description: Delete the security skill directory
    status: complete
    deps: []
    parallel: true
    context: |
      The security skill was a stub (only template headers, no content) and is
      being removed as part of the simplification. Security considerations can
      be incorporated into Discovery's context gathering or added back later
      if needed.
    requirements:
      - Delete the entire agent/skills/security/ directory
    criteria:
      - Directory agent/skills/security/ no longer exists
    files:
      - agent/skills/security/SKILL.md
    context_files: []
    agent: codex
  - id: "1.4"
    description: Delete the review skill directory
    status: complete
    deps: []
    parallel: true
    context: |
      The review skill was a stub (only template headers, no content) and is
      being removed as part of the simplification. Code review can be incorporated
      into the Verify phase or added back as a dedicated skill later if needed.
    requirements:
      - Delete the entire agent/skills/review/ directory
    criteria:
      - Directory agent/skills/review/ no longer exists
    files:
      - agent/skills/review/SKILL.md
    context_files: []
    agent: codex
  - id: "2.1"
    description: Update Discovery skill to handle all request sizes
    status: complete
    deps:
      - "1.1"
      - "1.2"
    parallel: false
    context: |
      Discovery currently says "Skip to Intake if" for smaller requests. Since
      Intake is being removed, Discovery must handle all planning work regardless
      of size. The full decomposition ladder (outcomes → capabilities → features
      → steps) should be used for all requests.
    requirements:
      - Remove the 'Skip to Intake if' section entirely
      - Update the 'When to Use' section to indicate Discovery handles ALL planning
      - Remove the 'Key Differences from Intake' table
      - Update any remaining references to Intake skill
      - Keep the decomposition ladder unchanged (full ladder for all requests)
      - |
        Add PostToolUse hook to YAML frontmatter to auto-validate plans on write:
        ```yaml
        hooks:
          PostToolUse:
            - matcher: "Write"
              hooks:
                - type: command
                  command: "node agent/scripts/validate-plan.js"
        ```
      - |
        Add a 'Validate the Plan' section after 'Output the Plan' explaining:
        - Plans are automatically validated via PostToolUse hook when written
        - Manual validation command: node agent/scripts/validate-plan.js work/plans/<plan>.yaml
        - This catches common issues like unquoted colons
      - |
        Add a 'YAML Formatting Rules' section with guidance on:
        - Always quote strings containing special characters (colons, brackets, etc.)
        - Example of BAD: criteria: Output shows: timestamp value
        - Example of GOOD: criteria: "Output shows: timestamp value"
        - Common YAML gotchas: colons followed by space, special char prefixes, multi-line strings
        - Rule: When in doubt, use double quotes around the entire value
    criteria:
      - No references to 'intake' or '/intake' in the skill file
      - Skill clearly states it handles all planning work
      - Decomposition ladder remains intact
      - YAML frontmatter includes hooks.PostToolUse with Write matcher running validate-plan.js
      - Has 'Validate the Plan' section with auto-validation info
      - Has 'YAML Formatting Rules' section with quoting guidance
    files:
      - agent/skills/discovery/SKILL.md
    context_files:
      - agent/skills/discovery/SKILL.md
    agent: codex
  - id: "3.1"
    description: Update Simulate skill to reference Discovery instead of Plan
    status: complete
    deps:
      - "1.2"
    parallel: false
    context: |
      The Simulate skill currently references the Plan skill for making changes
      to plans. Since Plan is being removed, these references should point to
      Discovery instead.
    requirements:
      - "Line 28: Change 'use Discovery or Plan first' to 'use Discovery first'"
      - "Line 218: Change 'use the Plan skill' to 'use the Discovery skill'"
      - Search for any other references to Plan skill and update them
    criteria:
      - No references to 'plan skill' or '/plan' in the file
      - References to modifying plans point to Discovery
    files:
      - agent/skills/simulate/SKILL.md
    context_files:
      - agent/skills/simulate/SKILL.md
    agent: codex
  - id: "4.1"
    description: Rewrite CLAUDE.md for simplified workflow
    status: complete
    deps:
      - "2.1"
      - "3.1"
    parallel: true
    context: |
      The CLAUDE.md file defines how Claude operates in this project. It currently
      references the Intake → Plan flow for Planning Mode. This needs to be
      updated to reflect the new Discovery-centric workflow.
    requirements:
      - Update Mode Detection to reference Discovery instead of Intake → Plan
      - Update Planning Mode to use /discovery skill only
      - Keep Worker Mode unchanged (execute → verify → report)
      - Update any references to removed skills
      - Keep the worker contract (JSON output, exit codes) unchanged
    criteria:
      - No references to /intake or /plan skills
      - Planning Mode clearly uses /discovery
      - Worker Mode still uses /execute, /verify, /report
    files:
      - .claude/CLAUDE.md
    context_files:
      - .claude/CLAUDE.md
    agent: codex
  - id: "4.2"
    description: Update Codex and Gemini agent configs
    status: complete
    deps:
      - "2.1"
      - "3.1"
    parallel: true
    context: |
      The .codex/AGENTS.md and .gemini/GEMINI.md files are nearly identical to
      CLAUDE.md and need the same updates for consistency.
    requirements:
      - Apply same changes as CLAUDE.md to both files
      - Update Mode Detection to reference Discovery
      - Update Planning Mode to use /discovery skill only
      - Keep Worker Mode unchanged
    criteria:
      - No references to /intake or /plan skills in either file
      - Both files are consistent with CLAUDE.md
    files:
      - .codex/AGENTS.md
      - .gemini/GEMINI.md
    context_files:
      - .claude/CLAUDE.md
    agent: codex
  - id: "4.3"
    description: Rewrite WORKFLOW.md for simplified protocol
    status: complete
    deps:
      - "2.1"
      - "3.1"
    parallel: true
    context: |
      The WORKFLOW.md defines the canonical workflow protocol. It currently
      describes a 5-phase workflow (Intake → Plan → Execute → Verify → Report).
      This needs to be simplified to reflect Discovery as the planning entry point.
    requirements:
      - "Update overview to reflect new workflow: Discovery → Execute → Verify → Report"
      - Remove Phase 1 (Intake) section entirely
      - Remove Phase 2 (Plan) section entirely
      - Update Discovery section to be the primary planning phase (not optional Phase 0)
      - Keep Execute, Verify, Report phases unchanged
      - Update Orchestrated Workflow Mode section
      - Update 'When to use Discovery vs Intake' to remove Intake option
      - Keep agent-to-agent handoff protocol unchanged
    criteria:
      - No references to Intake phase
      - No references to Plan phase (as separate from Discovery)
      - Discovery is clearly the planning entry point
      - Execute, Verify, Report phases are preserved
      - Worker contract unchanged
    files:
      - agent/policies/WORKFLOW.md
    context_files:
      - agent/policies/WORKFLOW.md
    agent: codex
  - id: "5.1"
    description: Consolidate plan schemas
    status: complete
    deps:
      - "4.3"
    parallel: false
    context: |
      Currently there are two plan schemas: plan-schema.yaml (basic) and
      discovery-plan-schema.yaml (extended with context fields). Since Discovery
      is now the only planning mechanism, the extended schema should become
      the canonical plan schema.
    requirements:
      - Delete agent/schemas/plan-schema.yaml
      - Rename agent/schemas/discovery-plan-schema.yaml to agent/schemas/plan-schema.yaml
      - Update the title in the schema from 'Discovery Plan Schema' to 'Plan Schema'
      - Update description to remove 'Discovery phase' specific language
    criteria:
      - "Only one plan schema exists: agent/schemas/plan-schema.yaml"
      - Schema contains the extended fields (context, requirements, context_files)
      - Schema title and description are generic (not Discovery-specific)
    files:
      - agent/schemas/plan-schema.yaml
      - agent/schemas/discovery-plan-schema.yaml
    context_files:
      - agent/schemas/discovery-plan-schema.yaml
      - agent/schemas/plan-schema.yaml
    agent: codex
  - id: "6.1"
    description: Update README.md for simplified workflow
    status: complete
    deps:
      - "4.3"
      - "5.1"
    parallel: true
    context: |
      The README.md describes the 5-phase workflow and directory structure.
      It needs to be updated to reflect the simplified Discovery-centric model.
    requirements:
      - Update overview to describe Discovery → Execute → Verify → Report
      - Update the 'The 5 Phases' section (now fewer phases)
      - Update the mermaid workflow diagram
      - Update directory structure (remove intake/ and plan/ from skills list)
      - Update Planning Mode example to use /discovery
      - Remove references to intake and plan skills
    criteria:
      - README accurately describes the new workflow
      - No references to intake or plan skills
      - Directory structure matches actual structure after deletions
    files:
      - README.md
    context_files:
      - README.md
    agent: codex
  - id: "6.2"
    description: Update validate-plan.js if needed
    status: complete
    deps:
      - "5.1"
    parallel: true
    context: |
      The validate-plan.js script validates plan files against the schema.
      After schema consolidation, verify it still works correctly with the
      renamed schema file.
    requirements:
      - Check if script references discovery-plan-schema.yaml specifically
      - Update any hardcoded schema paths if needed
      - Test that validation still works
    criteria:
      - Script references the correct schema path (plan-schema.yaml)
      - Validation works for existing plan files
    files:
      - agent/scripts/validate-plan.js
    context_files:
      - agent/scripts/validate-plan.js
    agent: codex
