metadata:
  created_at: "2026-01-14T12:00:00Z"
  created_by: "Discovery-Agent"
  version: "1.0"
  source_idea: |
    Package orrery as a global npm CLI tool that installs skills into user agent
    directories. Projects should remain unaware of orrery - skills are self-contained
    and the .agent-work/ folder lives in the target project.
  outcomes:
    - "Users can install orrery globally and immediately use skills in any project"
    - "Agents discover and use orrery skills without knowing orrery exists"
    - "Skills are fully self-contained with embedded schemas"
    - "Projects use .agent-work/ for plans and reports"
    - "Orchestration runs from any project via npx orrery orchestrate"

steps:
  - id: "feature-1-package-structure"
    description: "Create npm package structure with CLI entry point"
    status: "pending"
    deps: []
    parallel: false
    context: |
      Transform orrery from a standalone project into a publishable npm package.
      The package should have a bin entry that allows global installation and
      CLI usage via 'npx orrery <command>' or 'orrery <command>' after global install.

      Current structure has scripts in agent/scripts/. These need to be reorganized
      into a proper CLI structure with a main entry point that routes to subcommands.
    requirements:
      - "package.json with bin entry pointing to bin/orrery.js"
      - "bin/orrery.js as CLI entry point with subcommand routing"
      - "Commands: install-skills, orchestrate, status, help"
      - "Use commander.js or similar for CLI argument parsing"
      - "Support both global install and npx usage"
    criteria:
      - "npm pack produces a valid tarball"
      - "npx . --help shows available commands"
      - "Global install (npm link) makes 'orrery' command available"
    files:
      - "package.json"
      - "bin/orrery.js"
      - "lib/cli/index.js"
      - "lib/cli/commands/index.js"
    context_files:
      - "agent/scripts/orchestrate.js"
      - "agent/scripts/clone-agent-skills.js"
    risk_notes: |
      Be careful not to break existing functionality. The current orchestrate.js
      should still work. Consider keeping agent/scripts/ as-is and having CLI
      wrappers call into them.

  - id: "feature-2-self-contained-skills"
    description: "Embed schemas into skill directories for self-containment"
    status: "pending"
    deps: []
    parallel: true
    context: |
      Currently skills reference schemas at agent/schemas/. When skills are
      installed to ~/.claude/skills/, they won't have access to these schemas.

      Each skill that needs a schema should have it embedded or bundled within
      the skill directory itself. The skill SKILL.md should reference the schema
      using a relative path (./schemas/plan-schema.yaml or similar).

      This makes each skill fully self-contained - an agent reading the skill
      doesn't need to know about orrery or reference external paths.
    requirements:
      - "Copy relevant schemas into each skill directory that needs them"
      - "Update SKILL.md files to reference schemas with relative paths"
      - "Ensure plan and execute skills have plan-schema.yaml"
      - "Ensure report skill has report-schema.yaml"
      - "Update any schema references in skill instructions"
    criteria:
      - "Skills can be copied to any location and still work"
      - "No references to agent/schemas/ remain in skills"
      - "Schema validation still works from skill directory"
    files:
      - "agent/skills/plan/schemas/plan-schema.yaml"
      - "agent/skills/plan/SKILL.md"
      - "agent/skills/execute/schemas/plan-schema.yaml"
      - "agent/skills/execute/SKILL.md"
      - "agent/skills/report/schemas/report-schema.yaml"
      - "agent/skills/report/SKILL.md"
      - "agent/skills/discovery/schemas/discovery-plan-schema.yaml"
      - "agent/skills/discovery/SKILL.md"
    context_files:
      - "agent/schemas/plan-schema.yaml"
      - "agent/schemas/report-schema.yaml"
      - "agent/schemas/discovery-plan-schema.yaml"
    risk_notes: |
      This creates some duplication (same schema in multiple skill dirs).
      Consider whether a shared schemas skill is better, but that adds
      complexity. For now, duplication is acceptable for self-containment.

  - id: "feature-3-install-skills-command"
    description: "Implement install-skills command to copy skills to agent directories"
    status: "pending"
    deps:
      - "feature-2-self-contained-skills"
    parallel: false
    context: |
      The install-skills command copies all skill directories from the orrery
      package to the user's agent skill directories. This is similar to the
      existing clone-agent-skills.js but targets user home directories instead
      of project directories.

      Should detect which agents are installed by checking for ~/.claude/,
      ~/.codex/, ~/.gemini/ directories. Only install to agents that exist.

      Consider: should this command also create the agent directory if it
      doesn't exist? Probably not - if ~/.claude/ doesn't exist, the user
      likely doesn't have Claude Code installed.
    requirements:
      - "Command: orrery install-skills [--agent claude|codex|gemini|all]"
      - "Auto-detect installed agents if no --agent flag"
      - "Copy agent/skills/* to ~/.claude/skills/, ~/.codex/skills/, etc."
      - "Show progress and what was installed"
      - "Handle case where skills already exist (overwrite with --force)"
      - "Dry-run mode with --dry-run flag"
    criteria:
      - "Running install-skills creates ~/.claude/skills/plan/, etc."
      - "Skills are identical to source (file comparison passes)"
      - "Command reports which agents were updated"
      - "Running twice without --force shows 'already installed' message"
    files:
      - "lib/cli/commands/install-skills.js"
      - "lib/utils/agent-detector.js"
      - "lib/utils/skill-copier.js"
    context_files:
      - "agent/scripts/clone-agent-skills.js"
    risk_notes: |
      Be careful about file permissions. User home directory skills should
      be readable by the agent processes. Also handle the case where the
      user doesn't have write access to their home directory (unlikely but
      possible in restricted environments).

  - id: "feature-4-work-directory-config"
    description: "Configure .agent-work/ as the default work directory"
    status: "pending"
    deps: []
    parallel: true
    context: |
      Skills and orchestrator currently reference work/ as the directory for
      plans, completed plans, and reports. This needs to change to .agent-work/
      to be more explicit and consistent across projects.

      The work directory location should be configurable but default to
      .agent-work/ in the current working directory.
    requirements:
      - "Default work directory is ./.agent-work/"
      - "Subdirectories: plans/, completed/, reports/"
      - "Orchestrator reads from process.cwd()/.agent-work/"
      - "Update skill instructions to reference .agent-work/"
      - "Support ORRERY_WORK_DIR environment variable override"
    criteria:
      - "Orchestrator creates .agent-work/ if it doesn't exist"
      - "Plans are created in .agent-work/plans/"
      - "Completed plans move to .agent-work/completed/"
      - "Reports go to .agent-work/reports/"
    files:
      - "lib/utils/paths.js"
      - "agent/skills/plan/SKILL.md"
      - "agent/skills/execute/SKILL.md"
      - "agent/scripts/orchestrate.js"
      - "agent/scripts/config/orchestrator.config.js"
    context_files:
      - "agent/scripts/config/orchestrator.config.js"
    risk_notes: |
      Changing the default path is a breaking change for anyone using orrery
      currently. Since this is pre-release, that's acceptable, but document
      it clearly.

  - id: "feature-5-orchestrate-command"
    description: "Implement orchestrate command as CLI wrapper"
    status: "pending"
    deps:
      - "feature-1-package-structure"
      - "feature-4-work-directory-config"
    parallel: false
    context: |
      The orchestrate command runs the existing orchestration logic but through
      the CLI interface. It should work from any project directory, looking for
      .agent-work/plans/ in the current working directory.

      The existing orchestrate.js has complex logic for dependency resolution,
      agent invocation, and plan updates. The CLI command should wrap this
      rather than reimplementing it.
    requirements:
      - "Command: orrery orchestrate [--plan <plan-file>] [--dry-run]"
      - "Without --plan, process all pending plans in .agent-work/plans/"
      - "Show progress as steps are executed"
      - "Exit with appropriate codes (0 success, 1 failure)"
      - "Support --verbose for detailed output"
    criteria:
      - "Running in a directory with .agent-work/plans/*.yaml executes plans"
      - "Completed steps are marked complete in plan files"
      - "Reports are generated in .agent-work/reports/"
      - "Exit code reflects overall success/failure"
    files:
      - "lib/cli/commands/orchestrate.js"
    context_files:
      - "agent/scripts/orchestrate.js"
      - "agent/scripts/lib/plan-loader.js"
      - "agent/scripts/lib/agent-invoker.js"
    risk_notes: |
      The orchestrator invokes agent CLIs (claude, gemini, etc.). Ensure these
      are properly detected and that errors are handled gracefully when an
      agent CLI is not installed.

  - id: "feature-6-status-command"
    description: "Implement status command to show plan status"
    status: "pending"
    deps:
      - "feature-4-work-directory-config"
    parallel: false
    context: |
      A simple utility command to show the status of plans in the current
      project. Reads .agent-work/plans/ and displays a summary of pending,
      in-progress, and completed plans/steps.
    requirements:
      - "Command: orrery status [--plan <plan-file>]"
      - "Show summary: X plans, Y pending steps, Z completed"
      - "List each plan with its overall status"
      - "With --plan, show detailed step status for one plan"
      - "Color coding: green=complete, yellow=in_progress, red=blocked"
    criteria:
      - "Running with no plans shows 'No plans found' message"
      - "Running with plans shows accurate status summary"
      - "Output is human-readable and scannable"
    files:
      - "lib/cli/commands/status.js"
    context_files:
      - "agent/scripts/lib/plan-loader.js"
    risk_notes: |
      Keep this simple. Don't over-engineer the output. A basic table or
      list format is sufficient.

  - id: "feature-7-update-existing-skills"
    description: "Update all skill SKILL.md files to reference .agent-work/"
    status: "pending"
    deps:
      - "feature-4-work-directory-config"
    parallel: false
    context: |
      All skill instructions that mention work/ need to be updated to reference
      .agent-work/ instead. This ensures consistency between the CLI and the
      skill instructions that agents read.
    requirements:
      - "Search all SKILL.md files for 'work/' references"
      - "Update to '.agent-work/' consistently"
      - "Ensure paths like work/plans become .agent-work/plans"
      - "Update any example commands or paths"
    criteria:
      - "No SKILL.md contains 'work/plans' (should be '.agent-work/plans')"
      - "Skill instructions are consistent with CLI behavior"
    files:
      - "agent/skills/*/SKILL.md"
    context_files:
      - "agent/skills/plan/SKILL.md"
      - "agent/skills/execute/SKILL.md"
      - "agent/skills/report/SKILL.md"
    risk_notes: |
      Be thorough - a mismatch between skill instructions and CLI behavior
      will confuse agents.

  - id: "feature-8-documentation"
    description: "Update README and add usage documentation"
    status: "pending"
    deps:
      - "feature-1-package-structure"
      - "feature-3-install-skills-command"
      - "feature-5-orchestrate-command"
    parallel: false
    context: |
      The current documentation reflects orrery as a standalone project.
      Update to reflect its new role as an installable tool.
    requirements:
      - "README.md with installation and usage instructions"
      - "Document: npm install -g orrery"
      - "Document: orrery install-skills"
      - "Document: orrery orchestrate"
      - "Document: orrery status"
      - "Explain the skill installation model"
    criteria:
      - "New user can follow README to install and use orrery"
      - "All CLI commands are documented with examples"
    files:
      - "README.md"
    context_files: []
    risk_notes: |
      Keep documentation concise. Don't over-document before the API is stable.
