$schema: http://json-schema.org/draft-07/schema#
type: object
title: Plan Schema
description: >
  Extended plan schema for planning output. Includes additional fields for
  rich context, enabling agents to execute steps autonomously without further
  user input.

properties:
  metadata:
    type: object
    description: Plan metadata including creation info and high-level context
    properties:
      created_at:
        type: string
        format: date-time
      created_by:
        type: string
      version:
        type: string
      source_idea:
        type: string
        description: The original idea or request that triggered discovery
      outcomes:
        type: array
        description: User-visible results this plan delivers
        items:
          type: string
      notes:
        type: string
        description: >
          General notes for agents executing this plan. Include testing commands,
          environment setup, project conventions, or any context that applies
          across all steps.
    required:
      - created_at
      - created_by
      - outcomes

  steps:
    type: array
    description: Array of plan steps defining the work to be done
    items:
      $ref: "#/definitions/Step"

required:
  - metadata
  - steps

definitions:
  Step:
    type: object
    description: Individual step in the plan, representing a feature or work unit
    required:
      - id
      - description
      - context
      - requirements
      - criteria
    properties:
      id:
        type: string
        description: Unique identifier for the step

      description:
        type: string
        description: Concise summary of what this step accomplishes

      status:
        type: string
        enum:
          - pending
          - in_progress
          - complete
          - blocked
        default: pending
        description: Current status of the step

      deps:
        type: array
        description: List of step IDs this step depends on
        items:
          type: string
        default: []

      parallel:
        type: boolean
        description: Whether this step can run in parallel with others
        default: false

      context:
        type: string
        description: >
          Background information needed to execute this step. Should include
          why this step exists, how it fits into the larger picture, and any
          relevant technical context an agent needs to understand before starting.

      requirements:
        type: array
        description: Specific requirements for this step
        items:
          type: string
        minItems: 1

      criteria:
        type: array
        description: Acceptance criteria - specific, testable conditions for completion
        items:
          type: string
        minItems: 1

      files:
        type: array
        description: Files this step will create or modify
        items:
          type: string
        default: []

      context_files:
        type: array
        description: >
          Files the agent should read for context before starting. These are
          not modified, but provide patterns, interfaces, or background needed
          to complete the step.
        items:
          type: string
        default: []

      commands:
        type: array
        description: Specific commands to execute (build, test, etc.)
        items:
          type: string
        default: []

      risk_notes:
        type: string
        description: Warnings, edge cases, or things to watch out for
